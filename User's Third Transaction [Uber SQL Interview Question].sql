WITH CT AS 
(
  SELECT USER_ID,
  COUNT(USER_ID) AS CT_ID
  FROM TRANSACTIONS
  GROUP BY USER_ID
),

CTE AS 
(
  SELECT USER_ID FROM CT
  WHERE CT_ID >2
  ORDER BY USER_ID
),

CTE_2 AS
(
  SELECT * FROM TRANSACTIONS T 
  JOIN CTE USING (USER_ID) 
  ORDER BY T.USER_ID,T.TRANSACTION_DATE
),

CTE_3 AS 
(
  SELECT ROW_NUMBER() OVER(ORDER BY USER_ID) AS IDS,*
  FROM CTE_2
)

SELECT USER_ID,SPEND,TRANSACTION_DATE FROM CTE_3 WHERE IDS%3=0; 


